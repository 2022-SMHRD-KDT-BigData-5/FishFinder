<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
  
<mapper namespace="com.smhrd.mapper.CommunityMapper">

    <!-- 총 게시글 갯수 출력 -->
	<select id="countBoard" resultType="integer">
		SELECT COUNT(*) FROM community_info
	</select>
    
	<!-- 모든 커뮤니티 글 가져오기 -->
    <select id="communityList" resultType="com.smhrd.domain.Community">
			SELECT * FROM community_info ORDER BY article_date DESC    
    </select>
    
    <!-- 내가 쓴 글 가져오기 -->
    <select id="communityMyList" resultType="com.smhrd.domain.Community">
			SELECT * FROM community_info where user_num=#{user_num} ORDER BY article_date DESC    
    </select>
		
    <!-- 커뮤니티 글 작성 -->
    <insert id="communityInsert" parameterType="com.smhrd.domain.Community">
        insert into community_info(article_title,article_content,article_date,user_num) 
        values(#{article_title},#{article_content},now(),#{user_num})
    </insert>
    
    <!-- 특정 커뮤니티 글 가져오기 -->
    <select id="communityContent" resultType="com.smhrd.domain.Community">
        select * from community_info where article_seq = #{article_seq}
    </select>
    
    <!-- 커뮤니티 글 수정하기 -->
    <update id="communityUpdate" parameterType="com.smhrd.domain.Community">
        update community_info set article_title=#{article_title}, article_content=#{article_content} where article_seq=#{article_seq}
    </update>
	
    <!-- 커뮤니티 조회수 업데이트 -->
    <update id="communityCntUpdate" parameterType="com.smhrd.domain.Community">
        update community_info set article_cnt=#{article_cnt} where article_seq=#{article_seq}
    </update>
    
    <!-- 커뮤니티 게시글 삭제 -->
    <delete id="communityDelete">
        delete from community_info where article_seq=#{article_seq}
    </delete>
    
    <!-- 신고받은 커뮤니티 글 가져오기 -->
    <select id="communityReport" resultType="com.smhrd.domain.Community">
        select * from community_info where article_report > 0
    </select>
    
           
    <!-- 검색 결과 -->
    <select  id="getBoardList" resultType="com.smhrd.domain.Community">
        select * from community_info
        	<trim prefix="WHERE" prefixOverrides="AND|OR">
        	    <if test="searchType=='article_title' and keyword != null and keyword != '' ">
        	        AND article_title like CONCAT('%', #{keyword}, '%')
        	    </if>
        	    <if test="searchType=='article_content' and keyword != null and keyword != '' ">
        	        AND article_content like CONCAT('%', #{keyword}, '%')
        	    </if>
        	</trim>
        ORDER BY article_date DESC
    </select>
           
    <!-- 검색 결과 수 -->
    <select  id="getBoardListCnt" resultType="int">
        select count(*) as listCnt from community_info
        	<trim prefix="WHERE" prefixOverrides="AND|OR">
        	    <if test="keyword != null and keyword != '' ">
        	        <if test="searchType=='article_title'">
        	            AND article_title like CONCAT('%', #{keyword}, '%')
        	        </if>
        	        <if test="searchType=='article_content'">
        	            AND article_content like CONCAT('%', #{keyword}, '%')
        	        </if>
				</if>
			</trim>
    </select>  

</mapper>